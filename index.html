<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>SAR Kneeboard — v9.1 (Mobile, Full)</title>
<link rel="preload" href="app.js" as="script">
<style>
  :root{
    --desk:#b9b19c; --paper:#f5f2e6; --paper2:#f0ecde; --ink:#1a1d2b; --rule:#bcae8f; --tab:#20345a;
    --btn-bg1:#2a426e; --btn-bg2:#163056; --btn-br:#0f1b35; --btnp-bg1:#bf2f2f; --btnp-bg2:#8f1f1f; --btnp-br:#5f1515;
    --pad: max(12px, env(safe-area-inset-left)); --padr:max(12px, env(safe-area-inset-right));
  }
  body.night{
    --desk:#081108; --paper:#0d150d; --paper2:#0a120a; --ink:#bafba9; --rule:#1a2b1a; --tab:#0f2a12;
    --btn-bg1:#113f1b; --btn-bg2:#0a2b12; --btn-br:#08210c; --btnp-bg1:#1e5c2a; --btnp-bg2:#184d23; --btnp-br:#0f3a19;
  }
  html,body{height:100%}
  *{box-sizing:border-box}
  body{
    margin:0;
    background:linear-gradient(0deg,#c7c0aa 0%, var(--desk) 60%);
    font:18px "Courier New", Courier, ui-monospace, monospace;
    color:var(--ink);
  }
  body.night{
    background:linear-gradient(0deg,#071007 0%, var(--desk) 60%);
    text-shadow:0 0 2px rgba(186,251,169,.35);
  }
  header{
    position:sticky; top:0; z-index:30;
    background:linear-gradient(180deg, rgba(245,242,230,.98), rgba(245,242,230,.9) 70%, rgba(245,242,230,0));
    padding:8px var(--padr) 6px var(--pad);
    border-bottom:2px solid var(--rule);
  }
  body.night header{ background:linear-gradient(180deg, rgba(13,21,13,.98), rgba(13,21,13,.9) 70%, rgba(13,21,13,0)); }
  header h1{ margin:0; font-weight:700; letter-spacing:.6px; font-size:18px; }
  .btns{margin-top:6px; display:flex; flex-wrap:wrap; gap:8px}
  button{
    border:2px solid var(--btn-br);
    background:linear-gradient(var(--btn-bg1),var(--btn-bg2));
    color:#fff; padding:10px 12px; border-radius:6px; font-weight:700; letter-spacing:.4px; cursor:pointer;
    min-height:44px;
  }
  button.primary{ background:linear-gradient(var(--btnp-bg1),var(--btnp-bg2)); border-color:var(--btnp-br); }
  main{max-width:980px; margin:0 auto; padding:14px var(--padr) 96px var(--pad)}
  .card{
    position:relative;
    background:repeating-linear-gradient(0deg, var(--paper), var(--paper) 28px, var(--paper2) 29px);
    border:2px solid var(--rule);
    border-radius:8px;
    padding:12px;
    margin:14px 0;
  }
  .card::before,.card::after{
    content:""; position:absolute; top:-7px; width:10px; height:10px; border-radius:50%;
    background:radial-gradient(circle at 35% 35%, #000 0%, #000 40%, #333 41%, #000 75%, transparent 76%);
    opacity:.9;
  }
  .card::before{ left:18px } .card::after{ right:18px }
  h2{ margin:0 0 8px; font-size:14px; text-transform:uppercase; letter-spacing:1px; padding:2px 6px; display:inline-block; border-left:4px solid var(--tab); }
  label{ display:block; margin:10px 0 6px; font-size:12px; letter-spacing:.6px; text-transform:uppercase; }
  .grid{display:grid; gap:10px}
  .g2{grid-template-columns:repeat(2,1fr)} .g3{grid-template-columns:repeat(3,1fr)}
  @media (max-width:760px){ .g2,.g3{grid-template-columns:1fr} }
  .row{display:flex; gap:10px; flex-wrap:wrap} .row > *{flex:1 1 0}
  input[type="text"], textarea, select{
    width:100%; max-width:100%; background:#fffdf7; color:var(--ink);
    border:2px solid #b7a98a; border-radius:6px; padding:10px 12px;
    font:18px "Courier New", Courier, ui-monospace, monospace; display:block;
  }
  input[type="text"]{ line-height:1.2 }
  body.night input[type="text"], body.night textarea{ background:#0c140c; color:#bafba9; border-color:#223622; }
  textarea{ min-height:92px; resize:vertical }
  .tbl{width:100%; border-collapse:collapse; font-size:16px; table-layout:fixed}
  .tbl th,.tbl td{border:2px solid var(--rule); padding:8px; text-align:left; vertical-align:middle}
  .tbl th{ background:#eee7d1; letter-spacing:.8px; text-transform:uppercase; font-size:12px }
  body.night .tbl th{ background:#0f170f }
  .tbl td input[type="text"]{ width:100%; padding:8px 10px; font-size:16px }
  .checklist label{border-bottom:1px dashed #c9bb98; padding:10px 0; margin:0} body.night .checklist label{ border-color:#274027 }
  .mini{font-size:12px; color:#3b3b3b} body.night .mini{ color:#79b171 }
  .inline{display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap} .inline > div{flex:1 1 0}
  .err{color:#9b0f0f; font-size:12px; margin-top:6px} body.night .err{ color:#e58f8f }
  .badge{ display:inline-block; padding:2px 6px; border:2px solid #244b24; background:#0a2b12; color:#bafba9; font-weight:700; margin-left:6px }
  .bad{ border-color:#5f1b1b; background:#3a1212; color:#ffd1d1 }
  .jswarn{position:sticky; top:0; background:#fff3cd; color:#532; border:2px solid #e0c26b; padding:8px 10px; margin:0; font-weight:700}
  body.night .jswarn{ background:#132013; color:#bafba9; border-color:#244b24 }
  .stack{ display:flex; flex-direction:column; gap:8px }
  .btn-row{ display:flex; gap:8px; flex-wrap:wrap }
  @media print{ header,.btns,#btnPrint,#btnNight,.jswarn{display:none!important} body{background:#fff; text-shadow:none} .card{box-shadow:none} }
</style>
</head>
<body>
<p id="jswarn" class="jswarn">If this banner stays visible, JavaScript is blocked or inline handlers are disallowed. This build uses an external script (app.js). Make sure it’s in the same folder.</p>
<header>
  <h1>SAR Kneeboard — Typewriter Edition</h1>
  <div class="btns">
    <button class="primary" id="btnSave">Save</button>
    <button id="btnLoad">Load</button>
    <button id="btnExport">Export</button>
    <button id="btnPrint">Print/PDF</button>
    <button id="btnReset">Reset</button>
    <button id="btnNow">Now→Top Times</button>
    <button id="btnNight">Night Mode</button>
  </div>
</header>

<main>
  <div class="card">
    <h2>Operation’s Officer Brief</h2>
    <div class="grid g2">
      <div>
        <label>Current time (HHMM local / Z)</label>
        <div class="row">
          <input type="text" inputmode="numeric" maxlength="4" id="brief_current_time" placeholder="1530">
          <input type="text" inputmode="numeric" maxlength="4" id="brief_current_time_z" placeholder="2330">
        </div>
        <div class="mini">24‑hour format, no colon</div>
      </div>
      <div>
        <label>SAR Call received (HHMM local / Z)</label>
        <div class="row">
          <input type="text" inputmode="numeric" maxlength="4" id="brief_call_time" placeholder="1542">
          <input type="text" inputmode="numeric" maxlength="4" id="brief_call_time_z" placeholder="2342">
        </div>
      </div>
    </div>

    <label>Location (Lat/Long “3655.39N/12208.28W”)</label>
    <div class="stack">
      <input type="text" id="brief_location" placeholder="3655.39N/12208.28W" autocapitalize="off" autocorrect="off" spellcheck="false">
      <div class="btn-row">
        <button type="button" id="btnGPS">Use GPS</button>
        <button type="button" id="btnOnScene">On‑Scene Wx</button>
        <button type="button" id="btnPointAvi">Point Wx (Aviation)</button>
      </div>
    </div>
    <div id="onscene_err" class="err"></div>

    <label>Search Object</label>
    <input type="text" id="brief_search_object" placeholder="21‑ft whaler white hull, 2 POB">

    <label>Tasking</label>
    <textarea id="brief_tasking"></textarea>

    <div class="grid g2">
      <div>
        <label>Reporting Source</label>
        <input type="text" id="brief_reporting_source">
      </div>
      <div>
        <label>Other Assets Responding</label>
        <input type="text" id="brief_other_assets">
      </div>
    </div>

    <div class="inline">
      <div>
        <label>Weather</label>
        <textarea id="brief_weather" placeholder="METAR or Point Wx summaries appear here"></textarea>
        <div id="metar_err" class="err"></div>
      </div>
      <div style="flex:0 0 280px">
        <label>METAR Station</label>
        <div class="row">
          <input type="text" id="metar_station" value="KSFO" placeholder="KSFO">
          <button type="button" id="btnMetar">Fetch METAR</button>
        </div>
        <div class="mini">Use Firefox if Safari blocks requests.</div>
      </div>
    </div>

    <label>Fuel Plan</label>
    <textarea id="brief_fuel_plan"></textarea>
  </div>

  <div class="card">
    <h2>Search Object Details</h2>
    <div class="grid g3">
      <div><label>Name</label><input type="text" id="so_name"></div>
      <div><label>Length</label><input type="text" id="so_length"></div>
      <div><label>Type</label><input type="text" id="so_type"></div>
      <div><label>Color</label><input type="text" id="so_color"></div>
      <div><label>POB</label><input type="text" id="so_pob"></div>
      <div><label>Position</label><input type="text" id="so_position"></div>
    </div>
  </div>

  <div class="card">
    <h2>On‑Scene Weather</h2>
    <div class="grid g3">
      <div><label>Wind</label><input type="text" id="os_wind"></div>
      <div><label>Ceiling</label><input type="text" id="os_ceiling"></div>
      <div><label>Visibility</label><input type="text" id="os_vis"></div>
      <div><label>Air Temp</label><input type="text" id="os_airtemp"></div>
      <div><label>Seas</label><input type="text" id="os_seas"></div>
      <div><label>Swells</label><input type="text" id="os_swells"></div>
    </div>
    <div class="mini" id="onscene_src"></div>
  </div>

  <div class="card">
    <h2>Pre‑Ramp Checklist</h2>
    <div class="checklist">
      <label><input type="checkbox" id="chk_weather"> Check Weather</label>
      <label><input type="checkbox" id="chk_notams"> Check NOTAMs</label>
      <label><input type="checkbox" id="chk_fuelstop"> Fuel / Defuel? Next Fuel Stop</label>
      <label><input type="checkbox" id="chk_adiz"> Coordinate ADIZ / Warning Areas</label>
      <label><input type="checkbox" id="chk_sign"> Sign for Aircraft</label>
      <label><input type="checkbox" id="chk_ifr"> File IFR Flight Plan</label>
      <label><input type="checkbox" id="chk_ops"> Call Ops</label>
      <label><input type="checkbox" id="chk_sap"> Search Action Plan from Sector</label>
      <label><input type="checkbox" id="chk_flightsurgeon"> Call Flight Surgeon</label>
      <label><input type="checkbox" id="chk_extragear"> Extra gear (litter, SLDMB, Nightsun)</label>
    </div>
  </div>

  <div class="card">
    <h2>Search Data</h2>
    <div class="grid g3">
      <div><label>CPT</label><input type="text" id="sd_cpt"></div>
      <div><label>Leg</label><input type="text" id="sd_leg"></div>
      <div><label>Width</label><input type="text" id="sd_width"></div>
      <div><label>T/S</label><input type="text" id="sd_ts"></div>
      <div><label>Creep</label><input type="text" id="sd_creep"></div>
      <div><label>CSP</label><input type="text" id="sd_csp"></div>
      <div><label>1st Turn</label><input type="text" id="sd_first"></div>
    </div>
  </div>

  <!-- Fuel Calculator (v9.1: fixed rates, no prefill) -->
  <div class="card" id="fuelCalc">
    <h2>Fuel Calculator (v9.1)</h2>
    <div class="grid g3">
      <div><label>Takeoff Fuel</label><input type="text" id="fc_start" inputmode="decimal" placeholder="e.g., 1500"></div>
      <div><label>Planned Landing Fuel</label><input type="text" id="fc_end" inputmode="decimal" placeholder="e.g., 400"></div>
      <div><label>Distance to On‑Scene (NM)</label><input type="text" id="fc_dist" inputmode="decimal" placeholder="e.g., 40"></div>
      <div><label>Cruise Speed (KTAS)</label><input type="text" id="fc_tas" inputmode="decimal" placeholder="e.g., 120"></div>
      <div><label>Distance to Landing (NM)</label><input type="text" id="fc_dist_back" inputmode="decimal" placeholder="e.g., 40"></div>
    </div>
    <div class="btns" style="margin-top:10px">
      <button type="button" id="fc_btn_calc">Compute</button>
      <button type="button" id="fc_btn_clear">Clear</button>
    </div>
    <div class="mini">Assumptions: Cruise 600/hr, Hover/Climb 700/hr. Units must match (lbs or gal). Times rounded to nearest minute.</div>
    <div id="fc_out" style="margin-top:10px; font-size:16px; line-height:1.35"></div>
  </div>

  <div class="card">
    <h2>Mission Log</h2>
    <table class="tbl">
      <thead><tr><th style="width:22%">Event</th><th>Time (Local)</th><th>Time (Z)</th><th>Fuel</th><th>Position</th></tr></thead>
      <tbody>
        <tr><td>REQ</td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_req_time_local" placeholder="1532"></td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_req_time_z" placeholder="2332"></td>
          <td><input type="text" id="evt_req_fuel" placeholder="lbs/gal"></td>
          <td><input type="text" id="evt_req_pos" placeholder="lat/long or fix"></td></tr>
        <tr><td>T/O</td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_to_time_local"></td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_to_time_z"></td>
          <td><input type="text" id="evt_to_fuel"></td>
          <td><input type="text" id="evt_to_pos"></td></tr>
        <tr><td>CSP O/S</td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_csp_time_local"></td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_csp_time_z"></td>
          <td><input type="text" id="evt_csp_fuel"></td>
          <td><input type="text" id="evt_csp_pos"></td></tr>
        <tr><td>TGT LOC</td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_tgt_time_local"></td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_tgt_time_z"></td>
          <td><input type="text" id="evt_tgt_fuel"></td>
          <td><input type="text" id="evt_tgt_pos"></td></tr>
        <tr><td>OHD</td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_ohd_time_local"></td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_ohd_time_z"></td>
          <td><input type="text" id="evt_ohd_fuel"></td>
          <td><input type="text" id="evt_ohd_pos"></td></tr>
        <tr><td>D/S</td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_ds_time_local"></td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_ds_time_z"></td>
          <td><input type="text" id="evt_ds_fuel"></td>
          <td><input type="text" id="evt_ds_pos"></td></tr>
        <tr><td>S/D</td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_sd_time_local"></td>
          <td><input type="text" inputmode="numeric" maxlength="4" id="evt_sd_time_z"></td>
          <td><input type="text" id="evt_sd_fuel"></td>
          <td><input type="text" id="evt_sd_pos"></td></tr>
      </tbody>
    </table>
  </div>

  <div class="card">
    <h2>Comments</h2>
    <textarea id="comments" placeholder="Freeform notes, comms snippets, frequencies, coordinates, etc."></textarea>
    <div class="mini">Autosaves every 5 seconds. Network needed for METAR, On‑Scene, and Point Wx.</div>
  </div>
</main>

<noscript><div class="jswarn">JavaScript is disabled. Buttons won’t work.</div></noscript>
<script src="app.js" defer></script>
</body>
</html>
